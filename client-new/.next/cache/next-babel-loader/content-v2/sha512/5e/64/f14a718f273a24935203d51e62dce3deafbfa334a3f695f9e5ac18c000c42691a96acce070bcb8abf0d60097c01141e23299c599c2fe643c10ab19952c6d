{"ast":null,"code":"import { GLOBAL, FORM, AUTH } from \"../defines\";\nimport axios from \"axios\";\nimport setAuthToken from \"../setAuthToken\";\nimport { API_BASE_URL } from \"@/utils/config\";\nimport Toast from 'light-toast';\nexport const setGlobalCurrency = cur => ({\n  type: GLOBAL.SET_CURRENCY,\n  cur\n});\nexport const setGlobalCategory = category => ({\n  type: GLOBAL.SET_CATEGORY,\n  category\n});\nexport const setCurrentForm = form => ({\n  type: FORM.SET_CURRENT_FORM,\n  form\n});\nexport const setGlobalSearch = keyword => ({\n  type: GLOBAL.SET_SEARCH,\n  keyword\n});\nexport const login = (email, password) => async dispatch => {\n  try {\n    const config = {\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    };\n    const {\n      data\n    } = await axios.post(`${API_BASE_URL}/api/v1/auth/login`, {\n      email,\n      password\n    }, config);\n    dispatch({\n      type: AUTH.LOG_IN,\n      payload: data\n    });\n    localStorage.setItem('userInfo', JSON.stringify(data));\n    localStorage.setItem('token', JSON.stringify(data.token));\n    await loadUser();\n    Toast.success('Successfully logged in');\n\n    if (window.location.pathname === '/login') {\n      Toast.success('Successfully logged in');\n    }\n  } catch (error) {\n    console.log(error.response);\n    Toast.fail(error.response.data.message);\n    dispatch({\n      type: AUTH.LOG_IN_ERROR,\n      payload: error.response && error.response.data.message ? error.response.data.message : error.message\n    });\n  }\n};\nexport const logout = () => dispatch => {\n  localStorage.removeItem('userInfo');\n  localStorage.removeItem('cartItems');\n  localStorage.removeItem('persist:root');\n  localStorage.removeItem('shippingAddress');\n  localStorage.removeItem('paymentMethod');\n  localStorage.removeItem('token');\n  dispatch({\n    type: AUTH.LOG_OUT\n  });\n  document.location.href = '/';\n};\nexport const loadUser = () => async dispatch => {\n  if (localStorage.token) {\n    const token = localStorage.token.replaceAll('\"', ''); //sending token to headers\n\n    setAuthToken(token);\n  }\n\n  try {\n    const res = await axios.get(`${API_BASE_URL}/api/v1/auth/me`);\n    dispatch({\n      type: AUTH.LOAD_USER,\n      payload: res.data\n    });\n  } catch (err) {\n    dispatch({\n      type: AUTH.LOAD_USER_FAIL,\n      payload: err.response.data.error\n    });\n  }\n};\nexport const createOrder = order => async dispatch => {\n  try {\n    const config = {\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    };\n    const {\n      data\n    } = await axios.post(`${API_BASE_URL}/api/orders`, order, config);\n    dispatch({\n      type: AUTH.ORDER_SUCCESS,\n      payload: data\n    });\n    localStorage.removeItem('cartItems');\n    localStorage.removeItem('persist:root');\n  } catch (error) {\n    const messages = error.response && error.response.data.message ? error.response.data.message : error.message;\n\n    if (messages === 'Not authorized, token failed') {\n      dispatch(logout());\n    }\n  }\n};\nexport const register = (firstName, lastName, email, password, role) => async dispatch => {\n  try {\n    const config = {\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    };\n    const {\n      data\n    } = await axios.post(`${API_BASE_URL}/api/v1/auth/register`, {\n      firstName,\n      lastName,\n      email,\n      password,\n      role\n    }, config);\n    dispatch({\n      type: AUTH.SIGN_UP,\n      payload: data\n    });\n    await loadUser();\n    localStorage.setItem('userInfo', JSON.stringify(data));\n    localStorage.setItem('token', JSON.stringify(data.token));\n  } catch (error) {\n    error.response && error.response.data.message ? error.response.data.message : error.message;\n    dispatch({\n      type: AUTH.SIGN_UP_ERROR,\n      payload: error.response && error.response.data.message ? error.response.data.message : error.message\n    });\n  }\n};","map":{"version":3,"sources":["C:/Users/2012b/WebstormProjects/ecommerce-MERN/client-new/src/redux/actions/globalActions.ts"],"names":["GLOBAL","FORM","AUTH","axios","setAuthToken","API_BASE_URL","Toast","setGlobalCurrency","cur","type","SET_CURRENCY","setGlobalCategory","category","SET_CATEGORY","setCurrentForm","form","SET_CURRENT_FORM","setGlobalSearch","keyword","SET_SEARCH","login","email","password","dispatch","config","headers","data","post","LOG_IN","payload","localStorage","setItem","JSON","stringify","token","loadUser","success","window","location","pathname","error","console","log","response","fail","message","LOG_IN_ERROR","logout","removeItem","LOG_OUT","document","href","replaceAll","res","get","LOAD_USER","err","LOAD_USER_FAIL","createOrder","order","ORDER_SUCCESS","messages","register","firstName","lastName","role","SIGN_UP","SIGN_UP_ERROR"],"mappings":"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","sourcesContent":["import {GLOBAL, FORM, AUTH} from \"../defines\";\r\nimport axios from \"axios\";\r\nimport setAuthToken from \"../setAuthToken\";\r\nimport {API_BASE_URL} from \"@/utils/config\";\r\nimport Toast from 'light-toast';\r\n\r\nexport const setGlobalCurrency = (cur:string) => ({\r\n    type: GLOBAL.SET_CURRENCY,\r\n    cur,\r\n});\r\n\r\nexport const setGlobalCategory = (category:string) => ({\r\n    type: GLOBAL.SET_CATEGORY,\r\n    category,\r\n});\r\nexport const setCurrentForm = (form:string) => ({\r\n    type: FORM.SET_CURRENT_FORM,\r\n    form,\r\n});\r\n\r\nexport const setGlobalSearch = (keyword:string) => ({\r\n    type: GLOBAL.SET_SEARCH,\r\n    keyword,\r\n});\r\n\r\n\r\nexport const login = (email:string, password:string) => async (dispatch:any) => {\r\n    try {\r\n        const config = {\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n            },\r\n        }\r\n\r\n\r\n        const {data} = await axios.post(\r\n            `${API_BASE_URL}/api/v1/auth/login`,\r\n            {email, password},\r\n            config\r\n        )\r\n\r\n        dispatch({\r\n            type: AUTH.LOG_IN,\r\n            payload: data,\r\n        })\r\n        localStorage.setItem('userInfo', JSON.stringify(data))\r\n        localStorage.setItem('token', JSON.stringify(data.token))\r\n        await loadUser()\r\n        Toast.success('Successfully logged in')\r\n        if(window.location.pathname==='/login'){\r\n            Toast.success('Successfully logged in')\r\n        }\r\n\r\n    } catch (error) {\r\n        console.log(error.response)\r\n        Toast.fail(error.response.data.message)\r\n        dispatch({\r\n            type: AUTH.LOG_IN_ERROR,\r\n            payload:\r\n                error.response && error.response.data.message\r\n                    ? error.response.data.message\r\n                    : error.message,\r\n        })\r\n    }\r\n}\r\nexport const logout = () => (dispatch:any) => {\r\n    localStorage.removeItem('userInfo')\r\n    localStorage.removeItem('cartItems')\r\n    localStorage.removeItem('persist:root')\r\n    localStorage.removeItem('shippingAddress')\r\n    localStorage.removeItem('paymentMethod')\r\n    localStorage.removeItem('token')\r\n    dispatch({type: AUTH.LOG_OUT})\r\n    document.location.href = '/'\r\n}\r\nexport const loadUser = () => async (dispatch:any) => {\r\n    if (localStorage.token) {\r\n        const token=localStorage.token.replaceAll('\"','')\r\n        //sending token to headers\r\n        setAuthToken(token)\r\n    }\r\n    try {\r\n        const res = await axios.get(`${API_BASE_URL}/api/v1/auth/me`);\r\n        dispatch({\r\n            type: AUTH.LOAD_USER,\r\n            payload: res.data\r\n        })\r\n\r\n    } catch (err) {\r\n        dispatch({\r\n            type: AUTH.LOAD_USER_FAIL,\r\n            payload: err.response.data.error\r\n        })\r\n    }\r\n};\r\nexport const createOrder = (order:object) => async (dispatch:any) => {\r\n    try {\r\n\r\n        const config = {\r\n            headers: {\r\n                'Content-Type': 'application/json'\r\n            },\r\n        }\r\n\r\n        const { data } = await axios.post(`${API_BASE_URL}/api/orders`, order, config)\r\n\r\n        dispatch({\r\n            type:AUTH.ORDER_SUCCESS,\r\n            payload: data,\r\n        })\r\n\r\n        localStorage.removeItem('cartItems')\r\n        localStorage.removeItem('persist:root')\r\n    } catch (error) {\r\n        const messages =\r\n            error.response && error.response.data.message\r\n                ? error.response.data.message\r\n                : error.message\r\n        if (messages === 'Not authorized, token failed') {\r\n            dispatch(logout())\r\n        }\r\n    }\r\n}\r\n\r\nexport const register = (firstName:string,lastName:string, email:string, password:string, role:any) => async (dispatch:any) => {\r\n    try {\r\n        const config = {\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n            },\r\n        }\r\n\r\n        const {data} = await axios.post(\r\n            `${API_BASE_URL}/api/v1/auth/register`,\r\n            {firstName,lastName, email, password, role},\r\n            config\r\n        )\r\n\r\n        dispatch({\r\n            type: AUTH.SIGN_UP,\r\n            payload: data,\r\n        })\r\n        await loadUser()\r\n\r\n        localStorage.setItem('userInfo', JSON.stringify(data))\r\n        localStorage.setItem('token', JSON.stringify(data.token))\r\n    } catch (error) {\r\n        error.response && error.response.data.message\r\n            ? error.response.data.message\r\n            : error.message\r\n\r\n        dispatch({\r\n            type: AUTH.SIGN_UP_ERROR,\r\n\r\n            payload:\r\n                error.response && error.response.data.message\r\n                    ? error.response.data.message\r\n                    : error.message,\r\n        })\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}