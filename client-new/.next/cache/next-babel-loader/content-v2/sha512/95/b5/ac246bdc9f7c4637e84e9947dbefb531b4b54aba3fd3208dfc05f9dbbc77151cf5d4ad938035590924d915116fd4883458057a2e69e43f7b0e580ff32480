{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/2012b/WebstormProjects/ecommerce-MERN/client-new/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/Users/2012b/WebstormProjects/ecommerce-MERN/client-new/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { GLOBAL, AUTH } from \"../defines\";\nimport axios from \"axios\";\nimport setAuthToken from \"../setAuthToken\";\nimport { API_BASE_URL } from \"@/utils/config\";\nexport var setGlobalCurrency = function setGlobalCurrency(cur) {\n  return {\n    type: GLOBAL.SET_CURRENCY,\n    cur: cur\n  };\n};\nexport var setGlobalCategory = function setGlobalCategory(category) {\n  return {\n    type: GLOBAL.SET_CATEGORY,\n    category: category\n  };\n};\nexport var setGlobalSearch = function setGlobalSearch(keyword) {\n  return {\n    type: GLOBAL.SET_SEARCH,\n    keyword: keyword\n  };\n};\nexport var login = function login(data) {\n  return {\n    type: AUTH.LOG_IN,\n    payload: data\n  };\n};\nexport var register = function register(data) {\n  return {\n    type: AUTH.SIGN_UP,\n    payload: data\n  };\n};\nexport var logout = function logout() {\n  return function (dispatch) {\n    localStorage.removeItem('userInfo');\n    localStorage.removeItem('cartItems');\n    localStorage.removeItem('persist:root');\n    localStorage.removeItem('shippingAddress');\n    localStorage.removeItem('paymentMethod');\n    localStorage.removeItem('token');\n    dispatch({\n      type: AUTH.LOG_OUT\n    });\n    document.location.href = '/';\n  };\n};\nexport var loadUser = function loadUser() {\n  return /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch) {\n      var token, res;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (localStorage.token) {\n                token = localStorage.token.replaceAll('\"', ''); //sending token to headers\n\n                setAuthToken(token);\n              }\n\n              _context.prev = 1;\n              _context.next = 4;\n              return axios.get(\"\".concat(API_BASE_URL, \"/api/v1/auth/me\"));\n\n            case 4:\n              res = _context.sent;\n              dispatch({\n                type: AUTH.LOAD_USER,\n                payload: res.data.data\n              });\n              _context.next = 11;\n              break;\n\n            case 8:\n              _context.prev = 8;\n              _context.t0 = _context[\"catch\"](1);\n              dispatch({\n                type: AUTH.LOAD_USER_FAIL,\n                payload: _context.t0.response.data.error\n              });\n\n            case 11:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[1, 8]]);\n    }));\n\n    return function (_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n};\nexport var createOrder = function createOrder(order) {\n  return /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch) {\n      var config, _yield$axios$post, data, messages;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              config = {\n                headers: {\n                  'Content-Type': 'application/json'\n                }\n              };\n              _context2.next = 4;\n              return axios.post(\"\".concat(API_BASE_URL, \"/api/orders\"), order, config);\n\n            case 4:\n              _yield$axios$post = _context2.sent;\n              data = _yield$axios$post.data;\n              dispatch({\n                type: AUTH.ORDER_SUCCESS,\n                payload: data\n              });\n              localStorage.removeItem('cartItems');\n              localStorage.removeItem('persist:root');\n              _context2.next = 15;\n              break;\n\n            case 11:\n              _context2.prev = 11;\n              _context2.t0 = _context2[\"catch\"](0);\n              messages = _context2.t0.response && _context2.t0.response.data.message ? _context2.t0.response.data.message : _context2.t0.message;\n\n              if (messages === 'Not authorized, token failed') {\n                dispatch(logout());\n              }\n\n            case 15:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 11]]);\n    }));\n\n    return function (_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n};","map":{"version":3,"sources":["C:/Users/2012b/WebstormProjects/ecommerce-MERN/client-new/src/redux/actions/globalActions.ts"],"names":["GLOBAL","AUTH","axios","setAuthToken","API_BASE_URL","setGlobalCurrency","cur","type","SET_CURRENCY","setGlobalCategory","category","SET_CATEGORY","setGlobalSearch","keyword","SET_SEARCH","login","data","LOG_IN","payload","register","SIGN_UP","logout","dispatch","localStorage","removeItem","LOG_OUT","document","location","href","loadUser","token","replaceAll","get","res","LOAD_USER","LOAD_USER_FAIL","response","error","createOrder","order","config","headers","post","ORDER_SUCCESS","messages","message"],"mappings":"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","sourcesContent":["import {GLOBAL, FORM, AUTH} from \"../defines\";\r\nimport axios from \"axios\";\r\nimport setAuthToken from \"../setAuthToken\";\r\nimport {API_BASE_URL} from \"@/utils/config\";\r\nimport Toast from 'light-toast';\r\n\r\nexport const setGlobalCurrency = (cur:string) => ({\r\n    type: GLOBAL.SET_CURRENCY,\r\n    cur,\r\n});\r\n\r\nexport const setGlobalCategory = (category:string) => ({\r\n    type: GLOBAL.SET_CATEGORY,\r\n    category,\r\n});\r\n\r\nexport const setGlobalSearch = (keyword:string) => ({\r\n    type: GLOBAL.SET_SEARCH,\r\n    keyword,\r\n});\r\nexport const login = (data) => ({\r\n    type: AUTH.LOG_IN,\r\n    payload: data,\r\n});\r\nexport const register = (data) => ({\r\n    type: AUTH.SIGN_UP,\r\n    payload: data,\r\n});\r\n\r\nexport const logout = () => (dispatch:any) => {\r\n    localStorage.removeItem('userInfo')\r\n    localStorage.removeItem('cartItems')\r\n    localStorage.removeItem('persist:root')\r\n    localStorage.removeItem('shippingAddress')\r\n    localStorage.removeItem('paymentMethod')\r\n    localStorage.removeItem('token')\r\n    dispatch({type: AUTH.LOG_OUT})\r\n    document.location.href = '/'\r\n}\r\nexport const loadUser = () => async (dispatch:any) => {\r\n    if (localStorage.token) {\r\n        const token=localStorage.token.replaceAll('\"','')\r\n        //sending token to headers\r\n        setAuthToken(token)\r\n    }\r\n    try {\r\n        const res = await axios.get(`${API_BASE_URL}/api/v1/auth/me`);\r\n        dispatch({\r\n            type: AUTH.LOAD_USER,\r\n            payload: res.data.data\r\n        })\r\n\r\n    } catch (err) {\r\n        dispatch({\r\n            type: AUTH.LOAD_USER_FAIL,\r\n            payload: err.response.data.error\r\n        })\r\n    }\r\n};\r\nexport const createOrder = (order:object) => async (dispatch:any) => {\r\n    try {\r\n\r\n        const config = {\r\n            headers: {\r\n                'Content-Type': 'application/json'\r\n            },\r\n        }\r\n\r\n        const { data } = await axios.post(`${API_BASE_URL}/api/orders`, order, config)\r\n\r\n        dispatch({\r\n            type:AUTH.ORDER_SUCCESS,\r\n            payload: data,\r\n        })\r\n\r\n        localStorage.removeItem('cartItems')\r\n        localStorage.removeItem('persist:root')\r\n    } catch (error) {\r\n        const messages =\r\n            error.response && error.response.data.message\r\n                ? error.response.data.message\r\n                : error.message\r\n        if (messages === 'Not authorized, token failed') {\r\n            dispatch(logout())\r\n        }\r\n    }\r\n}\r\n\r\n"]},"metadata":{},"sourceType":"module"}