{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/2012b/WebstormProjects/ecommerce-MERN/client-new/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/Users/2012b/WebstormProjects/ecommerce-MERN/client-new/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { GLOBAL, FORM, AUTH } from \"../defines\";\nimport axios from \"axios\";\nimport setAuthToken from \"../setAuthToken\";\nimport { API_BASE_URL } from \"@/utils/config\";\nexport var setGlobalCurrency = function setGlobalCurrency(cur) {\n  return {\n    type: GLOBAL.SET_CURRENCY,\n    cur: cur\n  };\n};\nexport var setGlobalCategory = function setGlobalCategory(category) {\n  return {\n    type: GLOBAL.SET_CATEGORY,\n    category: category\n  };\n};\nexport var setCurrentForm = function setCurrentForm(form) {\n  return {\n    type: FORM.SET_CURRENT_FORM,\n    form: form\n  };\n};\nexport var setGlobalSearch = function setGlobalSearch(keyword) {\n  return {\n    type: GLOBAL.SET_SEARCH,\n    keyword: keyword\n  };\n};\nexport var login = function login(data) {\n  return {\n    type: AUTH.LOG_IN,\n    payload: data\n  };\n};\nexport var logout = function logout() {\n  return function (dispatch) {\n    localStorage.removeItem('userInfo');\n    localStorage.removeItem('cartItems');\n    localStorage.removeItem('persist:root');\n    localStorage.removeItem('shippingAddress');\n    localStorage.removeItem('paymentMethod');\n    localStorage.removeItem('token');\n    dispatch({\n      type: AUTH.LOG_OUT\n    });\n    document.location.href = '/';\n  };\n};\nexport var loadUser = function loadUser() {\n  return /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch) {\n      var token, res;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (localStorage.token) {\n                token = localStorage.token.replaceAll('\"', ''); //sending token to headers\n\n                setAuthToken(token);\n              }\n\n              _context.prev = 1;\n              _context.next = 4;\n              return axios.get(\"\".concat(API_BASE_URL, \"/api/v1/auth/me\"));\n\n            case 4:\n              res = _context.sent;\n              dispatch({\n                type: AUTH.LOAD_USER,\n                payload: res.data\n              });\n              _context.next = 11;\n              break;\n\n            case 8:\n              _context.prev = 8;\n              _context.t0 = _context[\"catch\"](1);\n              dispatch({\n                type: AUTH.LOAD_USER_FAIL,\n                payload: _context.t0.response.data.error\n              });\n\n            case 11:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[1, 8]]);\n    }));\n\n    return function (_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n};\nexport var createOrder = function createOrder(order) {\n  return /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch) {\n      var config, _yield$axios$post, data, messages;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              config = {\n                headers: {\n                  'Content-Type': 'application/json'\n                }\n              };\n              _context2.next = 4;\n              return axios.post(\"\".concat(API_BASE_URL, \"/api/orders\"), order, config);\n\n            case 4:\n              _yield$axios$post = _context2.sent;\n              data = _yield$axios$post.data;\n              dispatch({\n                type: AUTH.ORDER_SUCCESS,\n                payload: data\n              });\n              localStorage.removeItem('cartItems');\n              localStorage.removeItem('persist:root');\n              _context2.next = 15;\n              break;\n\n            case 11:\n              _context2.prev = 11;\n              _context2.t0 = _context2[\"catch\"](0);\n              messages = _context2.t0.response && _context2.t0.response.data.message ? _context2.t0.response.data.message : _context2.t0.message;\n\n              if (messages === 'Not authorized, token failed') {\n                dispatch(logout());\n              }\n\n            case 15:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 11]]);\n    }));\n\n    return function (_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n};\nexport var register = function register(firstName, lastName, email, password, role) {\n  return /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch) {\n      var config, _yield$axios$post2, data;\n\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              config = {\n                headers: {\n                  'Content-Type': 'application/json'\n                }\n              };\n              _context3.next = 4;\n              return axios.post(\"\".concat(API_BASE_URL, \"/api/v1/auth/register\"), {\n                firstName: firstName,\n                lastName: lastName,\n                email: email,\n                password: password,\n                role: role\n              }, config);\n\n            case 4:\n              _yield$axios$post2 = _context3.sent;\n              data = _yield$axios$post2.data;\n              dispatch({\n                type: AUTH.SIGN_UP,\n                payload: data\n              });\n              _context3.next = 9;\n              return loadUser();\n\n            case 9:\n              localStorage.setItem('userInfo', JSON.stringify(data));\n              localStorage.setItem('token', JSON.stringify(data.token));\n              _context3.next = 17;\n              break;\n\n            case 13:\n              _context3.prev = 13;\n              _context3.t0 = _context3[\"catch\"](0);\n              _context3.t0.response && _context3.t0.response.data.message ? _context3.t0.response.data.message : _context3.t0.message;\n              dispatch({\n                type: AUTH.SIGN_UP_ERROR,\n                payload: _context3.t0.response && _context3.t0.response.data.message ? _context3.t0.response.data.message : _context3.t0.message\n              });\n\n            case 17:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[0, 13]]);\n    }));\n\n    return function (_x3) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n};","map":{"version":3,"sources":["C:/Users/2012b/WebstormProjects/ecommerce-MERN/client-new/src/redux/actions/globalActions.ts"],"names":["GLOBAL","FORM","AUTH","axios","setAuthToken","API_BASE_URL","setGlobalCurrency","cur","type","SET_CURRENCY","setGlobalCategory","category","SET_CATEGORY","setCurrentForm","form","SET_CURRENT_FORM","setGlobalSearch","keyword","SET_SEARCH","login","data","LOG_IN","payload","logout","dispatch","localStorage","removeItem","LOG_OUT","document","location","href","loadUser","token","replaceAll","get","res","LOAD_USER","LOAD_USER_FAIL","response","error","createOrder","order","config","headers","post","ORDER_SUCCESS","messages","message","register","firstName","lastName","email","password","role","SIGN_UP","setItem","JSON","stringify","SIGN_UP_ERROR"],"mappings":"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","sourcesContent":["import {GLOBAL, FORM, AUTH} from \"../defines\";\r\nimport axios from \"axios\";\r\nimport setAuthToken from \"../setAuthToken\";\r\nimport {API_BASE_URL} from \"@/utils/config\";\r\nimport Toast from 'light-toast';\r\n\r\nexport const setGlobalCurrency = (cur:string) => ({\r\n    type: GLOBAL.SET_CURRENCY,\r\n    cur,\r\n});\r\n\r\nexport const setGlobalCategory = (category:string) => ({\r\n    type: GLOBAL.SET_CATEGORY,\r\n    category,\r\n});\r\nexport const setCurrentForm = (form:string) => ({\r\n    type: FORM.SET_CURRENT_FORM,\r\n    form,\r\n});\r\n\r\nexport const setGlobalSearch = (keyword:string) => ({\r\n    type: GLOBAL.SET_SEARCH,\r\n    keyword,\r\n});\r\nexport const login = (data) => ({\r\n    type: AUTH.LOG_IN,\r\n    payload: data,\r\n});\r\n\r\nexport const logout = () => (dispatch:any) => {\r\n    localStorage.removeItem('userInfo')\r\n    localStorage.removeItem('cartItems')\r\n    localStorage.removeItem('persist:root')\r\n    localStorage.removeItem('shippingAddress')\r\n    localStorage.removeItem('paymentMethod')\r\n    localStorage.removeItem('token')\r\n    dispatch({type: AUTH.LOG_OUT})\r\n    document.location.href = '/'\r\n}\r\nexport const loadUser = () => async (dispatch:any) => {\r\n    if (localStorage.token) {\r\n        const token=localStorage.token.replaceAll('\"','')\r\n        //sending token to headers\r\n        setAuthToken(token)\r\n    }\r\n    try {\r\n        const res = await axios.get(`${API_BASE_URL}/api/v1/auth/me`);\r\n        dispatch({\r\n            type: AUTH.LOAD_USER,\r\n            payload: res.data\r\n        })\r\n\r\n    } catch (err) {\r\n        dispatch({\r\n            type: AUTH.LOAD_USER_FAIL,\r\n            payload: err.response.data.error\r\n        })\r\n    }\r\n};\r\nexport const createOrder = (order:object) => async (dispatch:any) => {\r\n    try {\r\n\r\n        const config = {\r\n            headers: {\r\n                'Content-Type': 'application/json'\r\n            },\r\n        }\r\n\r\n        const { data } = await axios.post(`${API_BASE_URL}/api/orders`, order, config)\r\n\r\n        dispatch({\r\n            type:AUTH.ORDER_SUCCESS,\r\n            payload: data,\r\n        })\r\n\r\n        localStorage.removeItem('cartItems')\r\n        localStorage.removeItem('persist:root')\r\n    } catch (error) {\r\n        const messages =\r\n            error.response && error.response.data.message\r\n                ? error.response.data.message\r\n                : error.message\r\n        if (messages === 'Not authorized, token failed') {\r\n            dispatch(logout())\r\n        }\r\n    }\r\n}\r\n\r\nexport const register = (firstName:string,lastName:string, email:string, password:string, role:any) => async (dispatch:any) => {\r\n    try {\r\n        const config = {\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n            },\r\n        }\r\n\r\n        const {data} = await axios.post(\r\n            `${API_BASE_URL}/api/v1/auth/register`,\r\n            {firstName,lastName, email, password, role},\r\n            config\r\n        )\r\n\r\n        dispatch({\r\n            type: AUTH.SIGN_UP,\r\n            payload: data,\r\n        })\r\n        await loadUser()\r\n\r\n        localStorage.setItem('userInfo', JSON.stringify(data))\r\n        localStorage.setItem('token', JSON.stringify(data.token))\r\n    } catch (error) {\r\n        error.response && error.response.data.message\r\n            ? error.response.data.message\r\n            : error.message\r\n\r\n        dispatch({\r\n            type: AUTH.SIGN_UP_ERROR,\r\n\r\n            payload:\r\n                error.response && error.response.data.message\r\n                    ? error.response.data.message\r\n                    : error.message,\r\n        })\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}